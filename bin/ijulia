#!/bin/bash

usage() {
  echo run ijulia container over current directory. usage:
  echo "  ijulia <--start|--stop|--remove>"
  echo
}

image=${image:-purzelrakete/ijulia-nightly}

start() {
  2>/dev/null docker start ijulia || docker run \
    --name ijulia \
    --publish 8888:8888 \
    --rm \
    --tty \
    --volume $(pwd):/srv/app  \
    --workdir /srv/app \
    $image ijulia
}

stop() {
  echo stopping ijulia...
  docker stop ijulia
}

remove() {
  echo removing ijulia... && (
    exec &>/dev/null
    stop
    docker rm ijulia
    docker rmi -f $image
  )
}

while test "$#" -gt 0
do
  case "$1" in
    --help|-h)
      usage && exit 0
      ;;
    --start|-s)
      start && exit 0 || { echo >&2 could not start ijulia; exit 1; }
      ;;
    --stop|-h)
      stop && exit 0 || { echo >&2 could not stop ijulia; exit 1; }
      ;;
    --remove|-r)
      remove
      exit 0
      ;;
    *)
      break
      ;;
  esac
done

# no arguments were passed
usage && exit 2
